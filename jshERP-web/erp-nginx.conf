# 核心：适配GLHERP V3.6的Nginx反向代理配置
server {
    listen 80;
    server_name localhost;
    charset utf-8;
    root /usr/share/nginx/html; # 前端Vue静态页存放目录（Docker镜像默认路径）
    index index.html; # 前端入口页

    # 规则1：所有以 /jshERP-boot/ 开头的请求 → 反向代理到SpringBoot后端（核心分流）
    location /jshERP-boot/ {
        # ✅ 替换这里：填写你的SpringBoot后端服务地址（3种写法任选）
        # ✔ 写法1（Docker容器互联）：后端容器名+端口（推荐，Docker内部通信）
        # proxy_pass http://jsh-erp-backend:9999;  # 使用容器名
        # ✔ 写法2（宿主机IP）：后端部署在宿主机，填写宿主机IP+端口
        proxy_pass http://127.0.0.1:9999;
;         proxy_pass http://172.17.0.1:9999;
;         proxy_pass http://8.152.192.183:9999;
;         proxy_pass http://host.docker.internal:9999;  # Docker内部访问宿主机
        # ✔ 写法3（本地调试）：后端在本机，填写localhost+端口
        # proxy_pass http://localhost:9999;

        # 反向代理必备配置（固定写法，复制即可）
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # 规则2：前端Vue路由适配（解决刷新404、history模式路由失效）
    location / {
        try_files $uri $uri/ /index.html;
        add_header Cache-Control "no-cache, no-store"; # 禁用缓存，避免304问题
    }

    # 规则3：静态资源缓存（提升加载速度，可选）
    location ~* \.(css|js|png|jpg|ico|svg)$ {
        expires 7d; # 静态资源缓存7天
        add_header Cache-Control "public";
    }
}